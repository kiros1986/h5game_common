/**
 *文件用途说明:添加更多按钮
 *作者姓名:huangguanhua
 *联系方式:86732415@qq.com   
 *制作日期:20151020
 **/


(function(window) {
    document.write('<link href="http://h5.static.myappgame.com/common/h5gameMore.css" rel="stylesheet" type="text/css">');
    with(document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];



    var $moreButton = $('<div id="share_menu"  class="bdsharebuttonbox"><div class="share_buttons" style="display:none"><div><a href="#"class="sharBtn bds_qzone "data-cmd="qzone"title="分享到QQ空间"></a></div><div><a href="#"class="sharBtn bds_tsina"data-cmd="tsina"title="分享到新浪微博"></a></div><div><a href="#"class="sharBtn bds_tqq"data-cmd="tqq"title="分享到腾讯微博"></a></div><div><a href="#"class="sharBtn bds_weixin"data-cmd="weixin"title="分享到微信"></a></div></div><div class="menu"><div class="share"id="share_toggle"data-rot="0"><div class="circle"></div><div class="bar"></div></div></div></div>');
    $("body").append($moreButton);

    window._bd_share_config = {
        "share": {
            "bdText": h5WxData.title,
            "bdMini": "2",
            "bdMiniList": h5WxData.link,
            "bdPic": h5WxData.imgUrl,
            "bdStyle": "0",
            "bdSize": "24",
        }
    };

    bdShareUpdate = function() {
        _bd_share_config.share.bdText = h5WxData.title;
        _bd_share_config.share.bdPic = h5WxData.imgUrl;
        _bd_share_config.share.bdMiniList = h5WxData.link;
    };


    $(document).ready(function(ev) {
        var $share_toggle = $('#share_toggle');
        var $share_menu = $('#share_menu .share_buttons');
        var rot;
        $share_toggle.on("click", function(ev) {
            console.log('1000');
            rot = parseInt($(this).data('rot')) - 180;
            $share_menu.show();
            $share_menu.css('transform', 'rotate(' + rot + 'deg)');
            $share_menu.css('webkitTransform', 'rotate(' + rot + 'deg)');
            if (rot / 180 % 2 == 0) {
                $share_menu.removeClass('active');
                $share_toggle.parent().removeClass('share_active');
                $share_toggle.removeClass('close');
            } else {
                bdShareUpdate();
                $share_menu.addClass('active');
                $share_toggle.parent().addClass('share_active');
                $share_toggle.addClass('close');
            };
            $(this).data('rot', rot);
        });
    });






    window.UCshareTimeline = function() {
        var title = document.title;
        var url = location.href;
        if (/(iPad|iPhone|iPod)/i.test(ua)) {
            ucbrowser.web_share(title, imgurl, url, 'kWeixinFriend', '', '', '');
        } else {
            ucweb.startRequest("shell.page_share", [title, imgurl, url, 'WechatTimeline', '', '', '']);
        };
    };
    var ua = navigator.userAgent.toLowerCase();
    //微信浏览器上提示右上角分享
    if (ua.match(/MicroMessenger/i) == "micromessenger") {
        $('.bds_weixin').removeAttr('data-cmd').attr('onclick', "alert(\'请点击当前屏幕右上角按钮进行分享。\')");
    };
    //只有UC浏览器支持调用分享到朋友圈
    if (/UCBrowser/i.test(ua)) {
        $('.bds_weixin').removeAttr('data-cmd').attr('onclick', "UCshareTimeline();");
    };

/**
 *文件用途说明:提交成绩
 *作者姓名:huangguanhua
 *联系方式:86732415@qq.com   
 *制作日期:20151020
 **/


    var passportUrl = "http://passport.appgame.com";
    var siteId = "9";
    var ssoToken = "3987d3accc1967a3bff1a2e21ec76fbe";
    var user_id = '';
    var postid = '';
    if (passportUrl && passportUrl.length) {
        $.ajax({
            url: passportUrl+'/sso',
            type: 'get',
            dataType: "jsonp",
            data: {
                sso_action: "check",
                sso_token: ssoToken,
                site_id: siteId,
                format: "json"
            },
            success: function(res) {
                if (res && res.username) {
                    user_id = res.user_id;   
                }
            }
        });
    }
    // level:关数, score:分数,post_id：文章id
    window.sendScore=function(level,score,post_id) {
         console.log('10000')
        if(post_id) {
          postid = post_id;
        }
        if(!user_id) {
            return;
        }
        if(localStorage.getItem('h5appgameScore')) {
            var json = $.parseJSON(localStorage.getItem('h5appgameScore'));
            if(json.id == user_id && json.postid == postid) {
                if(level < json.level || (level == json.level && score <= json.score)) {
                    return;
                }
            }
        }
        var sign = hex_md5(user_id+'&'+postid+'&'+level+'&'+score);
        $.ajax({
            url:"http://h5.appgame.com/wp-content/themes/gamezone-h5/post-score.php",
            type: 'POST',
            data: 'user_id='+user_id+'&postid='+postid+'&level='+level+'&score='+score+'&sign='+sign,
            success:function(data){
                localStorage.setItem('h5appgameScore',data);
                postid = $.parseJSON(data).postid;
            }   
        });       
    }

    window.setShareBtnPosition=function(y){
        $('#share_menu').css('top',y);
        console.log('setShareBtnPosition');
    }


})(window);

